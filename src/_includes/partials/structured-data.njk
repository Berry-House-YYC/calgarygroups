{# Structured Data (JSON-LD) #}
{% if page.url == "/" %}
{# Homepage structured data #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": {{ site.name | json | safe }},
  "description": {{ site.description | json | safe }},
  "url": {{ site.url | json | safe }},
  "image": {{ (site.url + "/screenshot.png") | json | safe }},
  "potentialAction": {
    "@type": "SearchAction",
    "target": {{ (site.url + "/?q={search_term_string}") | json | safe }},
    "query-input": "required name=search_term_string"
  },
  "mainEntity": {
    "@type": "ItemList",
    "name": "Calgary Organizations Directory",
    "description": "A directory of community organizations, clubs, and groups in Calgary",
    "numberOfItems": {{ collections.organizations.length | json | safe }},
    "itemListElement": [
      {%- for org in collections.organizations | slice(0, 10) %}
      {
        "@type": "ListItem",
        "position": {{ loop.index | json | safe }},
        "item": {
          "@type": "Organization",
          "name": {{ (org.data.name or org.data.title) | json | safe }},
          "url": {{ (site.url + org.url) | json | safe }}
        }
      }{%- if not loop.last %},{%- endif %}
      {%- endfor %}
    ]
  }
}
</script>
{% elif page.url and page.url starts with "/organizations/" %}
{# Organization page structured data #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": {{ (name or title) | json | safe }},
  "description": {{ (description or content | stripHtml | truncate(280)) | json | safe }},
  "url": {{ (site.url + page.url) | json | safe }},
  {%- if websiteUrl %}
  "sameAs": {{ websiteUrl | json | safe }},
  {%- endif %}
  "areaServed": {
    "@type": "City",
    "name": "Calgary",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "CA"
    }
  },
  {%- if type %}
  "additionalType": {{ type | json | safe }},
  {%- endif %}
  {%- if interests and interests.length > 0 %}
  "keywords": {{ (interests | join(", ")) | json | safe }},
  {%- endif %}
  {%- if status %}
  "status": {{ status | json | safe }},
  {%- endif %}
  "foundingDate": "2023"
}
</script>
{% else %}
{# Default page structured data #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": {{ (title or name) | json | safe }},
  "description": {{ (description or site.description) | json | safe }},
  "url": {{ (site.url + page.url) | json | safe }},
  "isPartOf": {
    "@type": "WebSite",
    "name": {{ site.name | json | safe }},
    "url": {{ site.url | json | safe }}
  }
}
</script>
{% endif %}
