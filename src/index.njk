---
layout: layouts/base.njk
title: Directory
---

{% set organizationsData %}
[
{% for org in collections.organizations %}
  {
    "name": {{ org.data.name | json | safe }},
    "type": {{ org.data.type | json | safe }},
    "interests": {{ (org.data.interests or []) | json | safe }},
    "age_range": {{ org.data.age_range | json | safe }},
    "identity_focused": {{ org.data.identity_focused | json | safe }},
    "meeting_format": {{ org.data.meeting_format | json | safe }},
    "location_area": {{ org.data.location_area | json | safe }},
    "status": {{ org.data.status | json | safe }},
    "website": {{ (org.templateContent | extractFirstUrl) | json | safe }},
    "excerpt": {{ (org.templateContent | stripHtml | truncate(220)) | json | safe }},
    "url": {{ org.url | json | safe }}
  }{% if not loop.last %},{% endif %}
{% endfor %}
]
{% endset %}

<template id="organizations-data">
{{ organizationsData | safe }}
</template>

<section class="space-y-6" x-data="directory(getOrganizations())">
  <header class="space-y-2">
    <h1 class="inline-flex items-center gap-3 text-3xl font-semibold tracking-tight">
      <i aria-hidden="true" class="fa-solid fa-magnifying-glass text-slate-900 dark:text-slate-100"></i>
      <span>Calgary Groups Directory</span>
    </h1>
    <p class="max-w-2xl text-slate-700 dark:text-slate-300">Search and filter grassroots organizations, clubs, activist groups, and community initiatives in Calgary.</p>
  </header>

  <div class="grid gap-4 xl:grid-cols-12">
    <aside class="min-w-0 xl:col-span-4">
      <div class="rounded-lg border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-800 dark:bg-slate-900">
        <div class="flex items-center justify-between gap-2">
          <h2 class="text-base font-semibold">Filters</h2>
          <button type="button" class="rounded px-2 py-1 text-sm font-medium text-slate-700 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-slate-400 dark:text-slate-200 dark:hover:bg-slate-800" @click="clearAll()">Clear</button>
        </div>

        <div class="mt-4">
          <label class="text-sm font-medium text-slate-900 dark:text-slate-100" for="search">Search</label>
          <input id="search" type="search" class="mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-200 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100 dark:focus:border-slate-500 dark:focus:ring-slate-800" placeholder="Search by name or description" x-model.trim="q" @input.debounce.250ms="syncUrl()" />
        </div>

        <div class="mt-4">
          <p class="text-sm font-medium text-slate-900 dark:text-slate-100">Type</p>
          <div class="mt-2 space-y-2 text-sm">
            <template x-for="t in typeOptions" :key="t">
              <label class="flex min-w-0 items-center gap-2">
                <input type="checkbox" class="h-4 w-4 rounded border-slate-300 text-slate-900 focus:ring-slate-400 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100" :value="t" x-model="selectedTypes" @change="syncUrl()" />
                <i aria-hidden="true" class="shrink-0" :class="[typeMeta(t).icon, typeMeta(t).iconColor]"></i>
                <span class="min-w-0 break-words" x-text="typeMeta(t).label"></span>
              </label>
            </template>
          </div>
        </div>

        <div class="mt-4">
          <p class="text-sm font-medium text-slate-900 dark:text-slate-100">Interests</p>
          <div class="mt-2 grid grid-cols-1 gap-2 text-sm sm:grid-cols-2">
            <template x-for="i in interestOptions" :key="i">
              <label class="flex min-w-0 items-center gap-2">
                <input type="checkbox" class="h-4 w-4 rounded border-slate-300 text-slate-900 focus:ring-slate-400 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100" :value="i" x-model="selectedInterests" @change="syncUrl()" />
                <i aria-hidden="true" class="shrink-0" :class="[interestMeta(i).icon, interestMeta(i).iconColor]"></i>
                <span class="min-w-0 break-words" x-text="interestMeta(i).label"></span>
              </label>
            </template>
          </div>
        </div>

        <fieldset class="mt-4">
          <legend class="text-sm font-medium text-slate-900 dark:text-slate-100">Interest matching</legend>
          <div class="mt-2 flex flex-wrap gap-3 text-sm">
            <label class="flex min-w-0 items-center gap-2">
              <input type="radio" class="h-4 w-4 border-slate-300 text-slate-900 focus:ring-slate-400 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100" name="interestMode" value="any" x-model="interestMode" @change="syncUrl()" />
              <span class="min-w-0 break-words">Match any</span>
            </label>
            <label class="flex min-w-0 items-center gap-2">
              <input type="radio" class="h-4 w-4 border-slate-300 text-slate-900 focus:ring-slate-400 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100" name="interestMode" value="all" x-model="interestMode" @change="syncUrl()" />
              <span class="min-w-0 break-words">Match all</span>
            </label>
          </div>
        </fieldset>

        <div class="mt-4">
          <p class="text-sm font-medium text-slate-900 dark:text-slate-100">Meeting format</p>
          <select class="mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-200 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100 dark:focus:border-slate-500 dark:focus:ring-slate-800" x-model="meetingFormat" @change="syncUrl()">
            <option value="">Any</option>
            <template x-for="m in meetingFormatOptions" :key="m">
              <option :value="m" x-text="m"></option>
            </template>
          </select>
        </div>

        <div class="mt-4">
          <p class="text-sm font-medium text-slate-900 dark:text-slate-100">Location</p>
          <select class="mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-200 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100 dark:focus:border-slate-500 dark:focus:ring-slate-800" x-model="locationArea" @change="syncUrl()">
            <option value="">Any</option>
            <template x-for="l in locationAreaOptions" :key="l">
              <option :value="l" x-text="l"></option>
            </template>
          </select>
        </div>

        <div class="mt-4">
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" class="h-4 w-4 rounded border-slate-300 text-slate-900 focus:ring-slate-400 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100" x-model="identityFocused" @change="syncUrl()" />
            <span class="font-medium text-slate-900 dark:text-slate-100">Identity-focused</span>
          </label>
        </div>

        <div class="mt-4 rounded-md bg-slate-50 px-3 py-2 text-sm text-slate-700 dark:bg-slate-950 dark:text-slate-300" aria-live="polite">
          <span class="font-medium" x-text="filtered.length"></span>
          <span>results</span>
        </div>
      </div>
    </aside>

    <div class="min-w-0 xl:col-span-8">
      <div class="grid gap-4 md:grid-cols-2">
        <template x-for="org in filtered" :key="org.url">
          <article class="rounded-lg border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-800 dark:bg-slate-900">
            <div class="flex min-w-0 flex-wrap items-start gap-3">
              <h2 class="min-w-0 flex-1 break-words text-lg font-semibold leading-snug">
                <template x-if="org.website">
                  <a class="block break-words rounded hover:underline focus:outline-none focus:ring-2 focus:ring-slate-400" :href="org.website" target="_blank" rel="noopener noreferrer" x-text="org.name"></a>
                </template>
                <template x-if="!org.website">
                  <a class="block break-words rounded hover:underline focus:outline-none focus:ring-2 focus:ring-slate-400" :href="org.url" x-text="org.name"></a>
                </template>
              </h2>
              <span class="inline-flex min-w-0 items-center gap-2 rounded-full px-3 py-1 text-xs font-medium ring-1 ring-inset" :class="typeMeta(org.type).pill">
                <i aria-hidden="true" :class="typeMeta(org.type).icon"></i>
                <span class="min-w-0 break-words" x-text="typeMeta(org.type).label"></span>
              </span>
            </div>
            <p class="mt-2 break-words text-sm text-slate-700 dark:text-slate-300" x-text="org.excerpt"></p>
            <div class="mt-3 flex flex-wrap gap-2">
              <template x-for="tag in (org.interests || []).slice(0, 3)" :key="tag">
                <span class="inline-flex min-w-0 items-center gap-2 rounded-full px-2 py-1 text-xs font-medium ring-1 ring-inset" :class="interestMeta(tag).pill">
                  <i aria-hidden="true" :class="interestMeta(tag).icon"></i>
                  <span class="min-w-0 break-words" x-text="interestMeta(tag).label"></span>
                </span>
              </template>
            </div>

            <div class="mt-4">
              <a class="fun-link inline-flex items-center gap-2 text-sm font-medium text-slate-900 hover:bg-slate-100 dark:text-slate-100 dark:hover:bg-slate-800" :href="org.url">
                <span>Learn More</span>
                <span aria-hidden="true">â†’</span>
              </a>
            </div>
          </article>
        </template>
      </div>

      <div class="mt-6 rounded-lg border border-slate-200 bg-white p-6 text-sm text-slate-700 shadow-sm dark:border-slate-800 dark:bg-slate-900 dark:text-slate-300" x-show="filtered.length === 0" x-cloak>
        <p class="font-medium text-slate-900 dark:text-slate-100">No results</p>
        <p class="mt-1">Try clearing filters or using a broader search.</p>
      </div>
    </div>
  </div>
</section>

<script>
  function getOrganizations() {
    const el = document.getElementById("organizations-data");
    if (!el) return [];
    try {
      return JSON.parse(el.innerHTML || "[]");
    } catch {
      return [];
    }
  }

  function directory(initialOrganizations) {
    return {
      organizations: Array.isArray(initialOrganizations) ? initialOrganizations : [],
      q: "",
      selectedTypes: [],
      selectedInterests: [],
      interestMode: "any",
      meetingFormat: "",
      locationArea: "",
      identityFocused: false,
      typeStyles: {
        "activist-group": {
          label: "Activist group",
          icon: "fa-solid fa-bullhorn",
          iconColor: "text-indigo-600",
          pill: "bg-indigo-50 text-indigo-800 ring-indigo-200"
        },
        "club": {
          label: "Club",
          icon: "fa-solid fa-user-group",
          iconColor: "text-blue-600",
          pill: "bg-blue-50 text-blue-800 ring-blue-200"
        },
        "grassroots-initiative": {
          label: "Grassroots",
          icon: "fa-solid fa-seedling",
          iconColor: "text-emerald-600",
          pill: "bg-emerald-50 text-emerald-800 ring-emerald-200"
        },
        "resource": {
          label: "Resource",
          icon: "fa-solid fa-circle-info",
          iconColor: "text-amber-700",
          pill: "bg-amber-50 text-amber-900 ring-amber-200"
        }
      },
      interestStyles: {
        "anti-racism": {
          label: "Anti-racism",
          icon: "fa-solid fa-hand-fist",
          iconColor: "text-amber-800",
          pill: "bg-amber-100 text-amber-900 ring-amber-200"
        },
        "arts-culture": {
          label: "Arts & culture",
          icon: "fa-solid fa-palette",
          iconColor: "text-fuchsia-700",
          pill: "bg-fuchsia-50 text-fuchsia-800 ring-fuchsia-200"
        },
        "education": {
          label: "Education",
          icon: "fa-solid fa-graduation-cap",
          iconColor: "text-sky-700",
          pill: "bg-sky-50 text-sky-800 ring-sky-200"
        },
        "environment": {
          label: "Environment",
          icon: "fa-solid fa-leaf",
          iconColor: "text-green-700",
          pill: "bg-green-50 text-green-800 ring-green-200"
        },
        "events": {
          label: "Events",
          icon: "fa-solid fa-calendar-days",
          iconColor: "text-violet-700",
          pill: "bg-violet-50 text-violet-800 ring-violet-200"
        },
        "health-wellness": {
          label: "Health & wellness",
          icon: "fa-solid fa-heart-pulse",
          iconColor: "text-rose-700",
          pill: "bg-rose-50 text-rose-800 ring-rose-200"
        },
        "hobby": {
          label: "Hobby",
          icon: "fa-solid fa-puzzle-piece",
          iconColor: "text-slate-700",
          pill: "bg-slate-100 text-slate-800 ring-slate-200"
        },
        "lgbtq2s": {
          label: "LGBTQ2S+",
          icon: "fa-solid fa-flag",
          iconColor: "text-slate-900",
          pill: "bg-gradient-to-r from-rose-200 via-amber-200 to-sky-200 text-slate-900 ring-slate-200"
        },
        "rec": {
          label: "Recreation",
          icon: "fa-solid fa-person-hiking",
          iconColor: "text-teal-700",
          pill: "bg-teal-50 text-teal-800 ring-teal-200"
        },
        "social-impact": {
          label: "Social impact",
          icon: "fa-solid fa-hands-holding-circle",
          iconColor: "text-cyan-700",
          pill: "bg-cyan-50 text-cyan-800 ring-cyan-200"
        },
        "sports-rec": {
          label: "Sports & rec",
          icon: "fa-solid fa-dumbbell",
          iconColor: "text-orange-700",
          pill: "bg-orange-50 text-orange-800 ring-orange-200"
        }
      },
      init() {
        this.hydrateFromUrl();
      },
      typeMeta(value) {
        return this.typeStyles[value] || { label: value || "", icon: "fa-regular fa-circle", iconColor: "text-slate-500", pill: "bg-slate-100 text-slate-800 ring-slate-200" };
      },
      interestMeta(value) {
        return this.interestStyles[value] || { label: value || "", icon: "fa-regular fa-circle", iconColor: "text-slate-500", pill: "bg-slate-100 text-slate-800 ring-slate-200" };
      },
      get typeOptions() {
        return [...new Set(this.organizations.map((o) => o.type).filter(Boolean))].sort();
      },
      get interestOptions() {
        const all = [];
        for (const org of this.organizations) {
          for (const tag of org.interests || []) all.push(tag);
        }
        return [...new Set(all.filter(Boolean))].sort();
      },
      get meetingFormatOptions() {
        return [...new Set(this.organizations.map((o) => o.meeting_format).filter(Boolean))].sort();
      },
      get locationAreaOptions() {
        return [...new Set(this.organizations.map((o) => o.location_area).filter(Boolean))].sort();
      },
      get filtered() {
        const q = (this.q || "").toLowerCase();
        return this.organizations.filter((org) => {
          if (q) {
            const haystack = `${org.name || ""} ${org.excerpt || ""}`.toLowerCase();
            if (!haystack.includes(q)) return false;
          }

          if (this.selectedTypes.length > 0 && !this.selectedTypes.includes(org.type)) return false;

          if (this.selectedInterests.length > 0) {
            const orgTags = Array.isArray(org.interests) ? org.interests : [];
            const ok = this.interestMode === "all"
              ? this.selectedInterests.every((t) => orgTags.includes(t))
              : this.selectedInterests.some((t) => orgTags.includes(t));
            if (!ok) return false;
          }

          if (this.meetingFormat && org.meeting_format !== this.meetingFormat) return false;
          if (this.locationArea && org.location_area !== this.locationArea) return false;

          if (this.identityFocused) {
            if (!org.identity_focused) return false;
          }

          return true;
        });
      },
      clearAll() {
        this.q = "";
        this.selectedTypes = [];
        this.selectedInterests = [];
        this.interestMode = "any";
        this.meetingFormat = "";
        this.locationArea = "";
        this.identityFocused = false;
        this.syncUrl();
      },
      hydrateFromUrl() {
        const params = new URLSearchParams(window.location.search);
        this.q = params.get("q") || "";
        this.selectedTypes = params.getAll("type");
        this.selectedInterests = params.getAll("interest");
        this.interestMode = params.get("interestMode") === "all" ? "all" : "any";
        this.meetingFormat = params.get("format") || "";
        this.locationArea = params.get("location") || "";
        this.identityFocused = params.get("identity") === "1";
      },
      syncUrl() {
        const params = new URLSearchParams();
        if (this.q) params.set("q", this.q);
        for (const t of this.selectedTypes) params.append("type", t);
        for (const i of this.selectedInterests) params.append("interest", i);
        if (this.interestMode === "all") params.set("interestMode", "all");
        if (this.meetingFormat) params.set("format", this.meetingFormat);
        if (this.locationArea) params.set("location", this.locationArea);
        if (this.identityFocused) params.set("identity", "1");
        const qs = params.toString();
        const url = qs ? `${window.location.pathname}?${qs}` : window.location.pathname;
        window.history.replaceState(null, "", url);
      }
    };
  }
</script>
